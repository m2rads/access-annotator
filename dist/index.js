"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var e=require("react"),t=require("rangy");require("rangy/lib/rangy-classapplier"),require("rangy/lib/rangy-core"),require("rangy/lib/rangy-highlighter"),require("rangy/lib/rangy-textrange"),require("rangy/lib/rangy-serializer"),require("rangy/lib/rangy-selectionsaverestore");var i=require("react-redux"),l=require("@reduxjs/toolkit");function o(e){return e&&"object"==typeof e&&"default"in e?e:{default:e}}var a=o(e),s=o(t);function r(e,t){void 0===t&&(t={});var i=t.insertAt;if(e&&"undefined"!=typeof document){var l=document.head||document.getElementsByTagName("head")[0],o=document.createElement("style");o.type="text/css","top"===i&&l.firstChild?l.insertBefore(o,l.firstChild):l.appendChild(o),o.styleSheet?o.styleSheet.cssText=e:o.appendChild(document.createTextNode(e))}}r("a{text-decoration:none}.clear{display:inline}.h-y{background-color:#fdd835}.h-g{background-color:#a5d6a7}.h-p{background-color:#f48fb1}.h-b{background-color:#e1f5fe}");r(".tooltip{background:#fff;border-radius:10px;box-shadow:0 4px 8px 0 rgba(0,0,0,.2),0 6px 20px 0 rgba(0,0,0,.19);opacity:0;padding:7px;position:fixed;z-index:1000}.h-color{align-items:center;display:flex;justify-content:space-evenly;margin:0 auto}.h-color p{font-size:1rem}.color-btn{border-radius:50%;cursor:pointer;margin-right:5px;padding:15px}.color-btn:focus,.color-btn:hover{border:2px solid #00695c}.h-y{background-color:#ffeb3b}.h-g{background-color:#c5e1a5}.h-p{background-color:#f8bbd0}.h-b{background-color:#81d4fa}.btn-gp{display:flex;flex-wrap:wrap;margin-top:10px;padding:10px 0;width:100%}.btn-gp>*{flex:1 100%}.btn-el{-webkit-appearance:none;-moz-appearance:none;background:#fff;border:none;border-bottom:2px solid #00695c;color:#000;cursor:pointer;display:inline-block;font-family:sans-serif;font-size:1rem;margin:0;padding:8px 5px;text-align:left;text-decoration:none;transition:background 90ms ease-in-out,transform 90ms ease;width:100%}.btn-gp:first-child{border-top:2px solid #00695c!important}.btn-el:focus,.btn-el:hover{background:#e0f2f1}.btn-el:focus{outline:1px solid #fff;outline-offset:-4px}.btn-el:active{transform:scale(.99)}");class n extends a.default.Component{constructor(e){super(e),this.state={hColor:"h-y"}}handleSetColor=e=>{this.setState(((t,i)=>({hColor:e})),(()=>{this.props.onHighlight(this.state.hColor)}))};render(){return this.props.annotator?a.default.createElement("div",{className:"tooltip",id:"tooltip",style:this.props.toolTipLocStyle},a.default.createElement("div",{className:"heading"},a.default.createElement("p",null,"Highlight"),a.default.createElement("div",{className:"h-color"},a.default.createElement("button",{className:"color-btn h-y",onClick:()=>this.handleSetColor("h-y")}),a.default.createElement("button",{className:"color-btn h-g",onClick:()=>this.handleSetColor("h-g")}),a.default.createElement("button",{className:"color-btn h-p",onClick:()=>this.handleSetColor("h-p")}),a.default.createElement("button",{className:"color-btn h-b",onClick:()=>this.handleSetColor("h-b")}))),a.default.createElement("div",{className:"btn-gp"},a.default.createElement("button",{className:"btn-el",onClick:()=>this.props.onAddNote(this.state.hColor)},"Add Note"),a.default.createElement("button",{className:"btn-el",onClick:()=>this.props.onRead()},"Read"),a.default.createElement("button",{className:"btn-el",onClick:()=>this.props.onRemove()},"Remove"))):a.default.createElement("div",{className:"tooltip",id:"tooltip",style:this.props.toolTipLocStyle},a.default.createElement("div",{className:"heading"},a.default.createElement("p",null,"Highlight"),a.default.createElement("div",{className:"h-color"},a.default.createElement("button",{className:"color-btn h-y",onClick:()=>this.handleSetColor("h-y")}),a.default.createElement("button",{className:"color-btn h-g",onClick:()=>this.handleSetColor("h-g")}),a.default.createElement("button",{className:"color-btn h-p",onClick:()=>this.handleSetColor("h-p")}),a.default.createElement("button",{className:"color-btn h-b",onClick:()=>this.handleSetColor("h-b")}))),a.default.createElement("div",{className:"btn-gp"},a.default.createElement("button",{className:"btn-el",onClick:()=>this.props.onRemove()},"Remove")))}}const h=i.useSelector,d=l.createSlice({name:"note",initialState:{value:""},reducers:{updated(e,t){e.value=t.payload},clearNote(e){e.value=""}}}),{updated:c,clearNote:g}=d.actions;var p=d.reducer;function u(e){const t=h((e=>e.note.value)),l=i.useDispatch();return a.default.createElement("div",null,a.default.createElement("div",{className:"note-container",style:e.stickyNoteStyle},a.default.createElement("div",{className:"note-header"},a.default.createElement("button",{className:"close-butt",onClick:()=>e.onCloseNote()},"X")),a.default.createElement("textarea",{className:"note-content",id:"noteTextArea",value:t,onChange:e=>l(c(e.target.value)),type:"text"}),a.default.createElement("div",{className:"note-footer"},a.default.createElement("button",{className:"save-butt",onClick:i=>e.onSave(t)},"Save"),a.default.createElement("button",{className:"del-butt",onClick:t=>e.onDelete()},"Delete"))))}r(".note-container{background:#fff;border:1px solid grey;border-radius:10px;box-shadow:0 4px 8px 0 rgba(0,0,0,.2),0 6px 10px 0 rgba(0,0,0,.19);opacity:0;position:fixed;z-index:10}.note-header{border-radius:10px 10px 0 0}.note-footer,.note-header{background-color:#ffefd5;height:20px}.note-footer{border-radius:0 0 10px 10px}.close-butt{border:none;border-radius:0 10px 0 0}.close-butt,.save-butt{float:right;height:20px;opacity:.5}.save-butt{border:none;border-radius:0 0 10px 0}.del-butt{border:none;border-radius:0 0 0 10px;float:left;height:20px;opacity:.5}.note-content{background-color:hsla(0,0%,100%,.2);border:none;color:#000;height:200px;width:200px}");class m extends a.default.Component{constructor(e){super(e),s.default.init(),this.highlighter=s.default.createHighlighter(),this.state={toolTipStyle:{opacity:0},stickyNoteStyle:{opacity:0},noteList:{},activeHighlight:null},this.showToolTip=this.showToolTip.bind(this),this.handleAddNote=this.handleAddNote.bind(this)}componentDidMount(){document.addEventListener("mouseup",this.handleMouseUp);let e=JSON.parse(localStorage.getItem("sr"));if(console.log(e),this.serializedHls=null!==e?e:[],this.props.localStorage||window.localStorage.clear(),this.highlighter.addClassApplier(s.default.createClassApplier("h-y",{ignoreWhiteSpace:!0,elementTagName:"span",elementProperties:{id:"highlight",onclick:e=>{this.activateTooltip(e)}}})),this.highlighter.addClassApplier(s.default.createClassApplier("h-g",{ignoreWhiteSpace:!0,elementTagName:"span",elementProperties:{id:"highlight",onclick:e=>{this.activateTooltip(e)}}})),this.highlighter.addClassApplier(s.default.createClassApplier("h-p",{ignoreWhiteSpace:!0,elementTagName:"span",elementProperties:{id:"highlight",onclick:e=>{this.activateTooltip(e)}}})),this.highlighter.addClassApplier(s.default.createClassApplier("h-b",{ignoreWhiteSpace:!0,elementTagName:"span",elementProperties:{id:"highlight",onclick:e=>{console.log(this.state.globalHighlighter),this.displaySerialized(),this.activateTooltip(e)}}})),null!==this.serializedHls)for(let e in this.serializedHls)try{s.default.deserializeSelection(this.serializedHls[e].sr),this.highlighter.highlightSelection(this.serializedHls[e].color);let t=this.highlighter.getHighlightsInSelection();console.log(t)}catch(e){}}componentDidUpdate(){}componentWillUnmount(){document.removeEventListener("mouseup",this.handleMouseUp)}render(){return this.props.annotator?a.default.createElement("div",{className:"App"},a.default.createElement(n,{toolTipLocStyle:this.state.toolTipStyle,onHighlight:e=>this.highlightSelectedText(e),onRemove:()=>this.removeHighlightSelection(),onAddNote:e=>this.handleAddNote(e),onRead:()=>this.highlightTextReader(),annotator:!0}),a.default.createElement(u,{stickyNoteStyle:this.state.stickyNoteStyle,onCloseNote:()=>this.handleCloseNote(),onSave:e=>this.saveNote(e),onDelete:()=>this.deleteNote()})):a.default.createElement("div",{className:"App"},a.default.createElement(n,{toolTipLocStyle:this.state.toolTipStyle,onHighlight:e=>this.highlightSelectedText(e),onRemove:()=>this.removeHighlightSelection(),annotator:!1}))}storeSerializedHighlights=(e,t,i)=>{let l={id:e,sr:i,color:t};console.log(l),this.serializedHls.push(l),window.localStorage.setItem("sr",JSON.stringify(this.serializedHls))};highlightSelectedText=e=>{let t=s.default.serializeSelection();this.highlighter.highlightSelection(e);let i=this.highlighter.getHighlightsInSelection();this.storeSerializedHighlights(i[0].id,e,t)};displaySerialized=()=>{this.setState({isSerialized:this.highlighter.serialize()}),console.log(this.state.isSerialized)};removeHighlightSelection=()=>{this.deleteNote(!0),this.highlighter.unhighlightSelection()};handleMouseUp=e=>{"highlight"!==e.target.className&&setTimeout(this.showToolTip(),2)};showToolTip=()=>{let e={opacity:0,display:"none"};""!==window.getSelection().toString()&&(e={top:"30%",left:"40%",opacity:1}),this.setState({toolTipStyle:e})};activateTooltip(e){"highlight"===e.target.id&&this.setState({toolTipStyle:{top:"30%",left:"40%",opacity:1}})}handleCloseNote=()=>{this.setState({stickyNoteStyle:{display:"none",opacity:0}}),this.props.clearNote()};noteDisplay(){this.setState({toolTipStyle:{opacity:0,display:"none"},stickyNoteStyle:{top:"30%",left:"50%",opacity:1}})}handleAddNote=e=>{let t=this.highlighter.getHighlightsInSelection();if(void 0!==t[0])console.log(t),console.log(this.serializedHls);else{let i=s.default.serializeSelection();this.highlighter.highlightSelection(e),t=this.highlighter.getHighlightsInSelection(),this.storeSerializedHighlights(t[0].id,e,i)}this.setState({activeHighlight:t[0].id},(()=>0));let i=window.localStorage.getItem(t[0].id);void 0!==i?this.props.updated(i):window.localStorage.setItem(t[0].id," "),this.noteDisplay()};saveNote=e=>{let t=this.state.activeHighlight;window.localStorage.setItem(t,e)};deleteNote=e=>{let t=this.state.activeHighlight;if(e){if(window.confirm("Delete this highlight (ID "+t+")?")&&null!==this.serializedHls)for(let e in this.serializedHls)try{let i=this.highlighter.getHighlightsInSelection();this.serializedHls[e].id===i[0].id&&(this.serializedHls.splice(e,1),window.localStorage.setItem("sr",JSON.stringify(this.serializedHls)),window.localStorage.removeItem(t),this.handleCloseNote())}catch(e){}}else window.confirm("Delete this note (ID "+t+")?")&&(window.localStorage.removeItem(t),this.handleCloseNote())};highlightTextReader=()=>{if(void 0===this.highlighter.getHighlightsInSelection()[0])if("speechSynthesis"in window){let t=window.getSelection().toString();var e=new SpeechSynthesisUtterance;e.text=t,window.speechSynthesis.speak(e)}else alert("Sorry, your browser doesn't support text to speech!");else console.log("throw an error")}}var f=i.connect((e=>({note:e.note.value})),(e=>({updated:t=>e(c(t)),clearNote:()=>e(g())})))(m);const b=l.configureStore({reducer:{note:p}});exports.Highlighter=function(e){return a.default.createElement("div",null,a.default.createElement(i.Provider,{store:b},a.default.createElement(f,e)))};
