import e from"react";import t from"rangy";import"rangy/lib/rangy-classapplier";import"rangy/lib/rangy-core";import"rangy/lib/rangy-highlighter";import"rangy/lib/rangy-textrange";import"rangy/lib/rangy-serializer";import"rangy/lib/rangy-selectionsaverestore";import{useDispatch as i,useSelector as o,connect as l,Provider as a}from"react-redux";import{createSlice as s,configureStore as n}from"@reduxjs/toolkit";function r(e,t){void 0===t&&(t={});var i=t.insertAt;if(e&&"undefined"!=typeof document){var o=document.head||document.getElementsByTagName("head")[0],l=document.createElement("style");l.type="text/css","top"===i&&o.firstChild?o.insertBefore(l,o.firstChild):o.appendChild(l),l.styleSheet?l.styleSheet.cssText=e:l.appendChild(document.createTextNode(e))}}r("a{text-decoration:none}.clear{display:inline}.h-y{background-color:#fdd835}.h-g{background-color:#a5d6a7}.h-p{background-color:#f48fb1}.h-b{background-color:#e1f5fe}");r(".tooltip{background:#fff;border-radius:10px;box-shadow:0 4px 8px 0 rgba(0,0,0,.2),0 6px 20px 0 rgba(0,0,0,.19);opacity:0;padding:7px;position:fixed;z-index:1000}.h-color{align-items:center;display:flex;justify-content:space-evenly;margin:0 auto}.h-color p{font-size:1rem}.color-btn{border-radius:50%;cursor:pointer;margin-right:5px;padding:15px}.color-btn:focus,.color-btn:hover{border:2px solid #00695c}.h-y{background-color:#ffeb3b}.h-g{background-color:#c5e1a5}.h-p{background-color:#f8bbd0}.h-b{background-color:#81d4fa}.btn-gp{display:flex;flex-wrap:wrap;margin-top:10px;padding:10px 0;width:100%}.btn-gp>*{flex:1 100%}.btn-el{-webkit-appearance:none;-moz-appearance:none;background:#fff;border:none;border-bottom:2px solid #00695c;color:#000;cursor:pointer;display:inline-block;font-family:sans-serif;font-size:1rem;margin:0;padding:8px 5px;text-align:left;text-decoration:none;transition:background 90ms ease-in-out,transform 90ms ease;width:100%}.btn-gp:first-child{border-top:2px solid #00695c!important}.btn-el:focus,.btn-el:hover{background:#e0f2f1}.btn-el:focus{outline:1px solid #fff;outline-offset:-4px}.btn-el:active{transform:scale(.99)}");class h extends e.Component{constructor(e){super(e),this.state={hColor:"h-y"}}handleSetColor=e=>{this.setState(((t,i)=>({hColor:e})),(()=>{this.props.onHighlight(this.state.hColor)}))};render(){return this.props.annotator?e.createElement("div",{className:"tooltip",id:"tooltip",style:this.props.toolTipLocStyle},e.createElement("div",{className:"heading"},e.createElement("p",null,"Highlight"),e.createElement("div",{className:"h-color"},e.createElement("button",{className:"color-btn h-y",onClick:()=>this.handleSetColor("h-y")}),e.createElement("button",{className:"color-btn h-g",onClick:()=>this.handleSetColor("h-g")}),e.createElement("button",{className:"color-btn h-p",onClick:()=>this.handleSetColor("h-p")}),e.createElement("button",{className:"color-btn h-b",onClick:()=>this.handleSetColor("h-b")}))),e.createElement("div",{className:"btn-gp"},e.createElement("button",{className:"btn-el",onClick:()=>this.props.onAddNote(this.state.hColor)},"Add Note"),e.createElement("button",{className:"btn-el",onClick:()=>this.props.onRead()},"Read"),e.createElement("button",{className:"btn-el",onClick:()=>this.props.onRemove()},"Remove"))):e.createElement("div",{className:"tooltip",id:"tooltip",style:this.props.toolTipLocStyle},e.createElement("div",{className:"heading"},e.createElement("p",null,"Highlight"),e.createElement("div",{className:"h-color"},e.createElement("button",{className:"color-btn h-y",onClick:()=>this.handleSetColor("h-y")}),e.createElement("button",{className:"color-btn h-g",onClick:()=>this.handleSetColor("h-g")}),e.createElement("button",{className:"color-btn h-p",onClick:()=>this.handleSetColor("h-p")}),e.createElement("button",{className:"color-btn h-b",onClick:()=>this.handleSetColor("h-b")}))),e.createElement("div",{className:"btn-gp"},e.createElement("button",{className:"btn-el",onClick:()=>this.props.onRemove()},"Remove")))}}const c=o,d=s({name:"note",initialState:{value:""},reducers:{updated(e,t){e.value=t.payload},clearNote(e){e.value=""}}}),{updated:g,clearNote:p}=d.actions;var m=d.reducer;function u(t){const o=c((e=>e.note.value)),l=i();return e.createElement("div",null,e.createElement("div",{className:"note-container",style:t.stickyNoteStyle},e.createElement("div",{className:"note-header"},e.createElement("button",{className:"close-butt",onClick:()=>t.onCloseNote()},"X")),e.createElement("textarea",{className:"note-content",id:"noteTextArea",value:o,onChange:e=>l(g(e.target.value)),type:"text"}),e.createElement("div",{className:"note-footer"},e.createElement("button",{className:"save-butt",onClick:e=>t.onSave(o)},"Save"),e.createElement("button",{className:"del-butt",onClick:e=>t.onDelete()},"Delete"))))}r(".note-container{background:#fff;border:1px solid grey;border-radius:10px;box-shadow:0 4px 8px 0 rgba(0,0,0,.2),0 6px 10px 0 rgba(0,0,0,.19);opacity:0;position:fixed;z-index:10}.note-header{border-radius:10px 10px 0 0}.note-footer,.note-header{background-color:#ffefd5;height:20px}.note-footer{border-radius:0 0 10px 10px}.close-butt{border:none;border-radius:0 10px 0 0}.close-butt,.save-butt{float:right;height:20px;opacity:.5}.save-butt{border:none;border-radius:0 0 10px 0}.del-butt{border:none;border-radius:0 0 0 10px;float:left;height:20px;opacity:.5}.note-content{background-color:hsla(0,0%,100%,.2);border:none;color:#000;height:200px;width:200px}");class b extends e.Component{constructor(e){super(e),t.init(),this.highlighter=t.createHighlighter(),this.state={toolTipStyle:{opacity:0},stickyNoteStyle:{opacity:0},noteList:{},activeHighlight:null},this.showToolTip=this.showToolTip.bind(this),this.handleAddNote=this.handleAddNote.bind(this)}componentDidMount(){document.addEventListener("mouseup",this.handleMouseUp);let e=JSON.parse(localStorage.getItem("sr"));if(console.log(e),this.serializedHls=null!==e?e:[],this.props.localStorage||window.localStorage.clear(),this.highlighter.addClassApplier(t.createClassApplier("h-y",{ignoreWhiteSpace:!0,elementTagName:"span",elementProperties:{id:"highlight",onclick:e=>{this.activateTooltip(e)}}})),this.highlighter.addClassApplier(t.createClassApplier("h-g",{ignoreWhiteSpace:!0,elementTagName:"span",elementProperties:{id:"highlight",onclick:e=>{this.activateTooltip(e)}}})),this.highlighter.addClassApplier(t.createClassApplier("h-p",{ignoreWhiteSpace:!0,elementTagName:"span",elementProperties:{id:"highlight",onclick:e=>{this.activateTooltip(e)}}})),this.highlighter.addClassApplier(t.createClassApplier("h-b",{ignoreWhiteSpace:!0,elementTagName:"span",elementProperties:{id:"highlight",onclick:e=>{console.log(this.state.globalHighlighter),this.displaySerialized(),this.activateTooltip(e)}}})),null!==this.serializedHls)for(let e in this.serializedHls)try{t.deserializeSelection(this.serializedHls[e].sr),this.highlighter.highlightSelection(this.serializedHls[e].color);let i=this.highlighter.getHighlightsInSelection();console.log(i)}catch(e){}}componentDidUpdate(){}componentWillUnmount(){document.removeEventListener("mouseup",this.handleMouseUp)}render(){return this.props.annotator?e.createElement("div",{className:"App"},e.createElement(h,{toolTipLocStyle:this.state.toolTipStyle,onHighlight:e=>this.highlightSelectedText(e),onRemove:()=>this.removeHighlightSelection(),onAddNote:e=>this.handleAddNote(e),onRead:()=>this.highlightTextReader(),annotator:!0}),e.createElement(u,{stickyNoteStyle:this.state.stickyNoteStyle,onCloseNote:()=>this.handleCloseNote(),onSave:e=>this.saveNote(e),onDelete:()=>this.deleteNote()})):e.createElement("div",{className:"App"},e.createElement(h,{toolTipLocStyle:this.state.toolTipStyle,onHighlight:e=>this.highlightSelectedText(e),onRemove:()=>this.removeHighlightSelection(),annotator:!1}))}storeSerializedHighlights=(e,t,i)=>{let o={id:e,sr:i,color:t};console.log(o),this.serializedHls.push(o),window.localStorage.setItem("sr",JSON.stringify(this.serializedHls))};highlightSelectedText=e=>{let i=t.serializeSelection();this.highlighter.highlightSelection(e);let o=this.highlighter.getHighlightsInSelection();this.storeSerializedHighlights(o[0].id,e,i)};displaySerialized=()=>{this.setState({isSerialized:this.highlighter.serialize()}),console.log(this.state.isSerialized)};removeHighlightSelection=()=>{this.deleteNote(!0),this.highlighter.unhighlightSelection()};handleMouseUp=e=>{"highlight"!==e.target.className&&setTimeout(this.showToolTip(),2)};showToolTip=()=>{let e={opacity:0,display:"none"};""!==window.getSelection().toString()&&(e={top:"30%",left:"40%",opacity:1}),this.setState({toolTipStyle:e})};activateTooltip(e){"highlight"===e.target.id&&this.setState({toolTipStyle:{top:"30%",left:"40%",opacity:1}})}handleCloseNote=()=>{this.setState({stickyNoteStyle:{display:"none",opacity:0}}),this.props.clearNote()};noteDisplay(){this.setState({toolTipStyle:{opacity:0,display:"none"},stickyNoteStyle:{top:"30%",left:"50%",opacity:1}})}handleAddNote=e=>{let i=this.highlighter.getHighlightsInSelection();if(void 0!==i[0])console.log(i),console.log(this.serializedHls);else{let o=t.serializeSelection();this.highlighter.highlightSelection(e),i=this.highlighter.getHighlightsInSelection(),this.storeSerializedHighlights(i[0].id,e,o)}this.setState({activeHighlight:i[0].id},(()=>0));let o=window.localStorage.getItem(i[0].id);void 0!==o?this.props.updated(o):window.localStorage.setItem(i[0].id," "),this.noteDisplay()};saveNote=e=>{let t=this.state.activeHighlight;window.localStorage.setItem(t,e)};deleteNote=e=>{let t=this.state.activeHighlight;if(e){if(window.confirm("Delete this highlight (ID "+t+")?")&&null!==this.serializedHls)for(let e in this.serializedHls)try{let i=this.highlighter.getHighlightsInSelection();this.serializedHls[e].id===i[0].id&&(this.serializedHls.splice(e,1),window.localStorage.setItem("sr",JSON.stringify(this.serializedHls)),window.localStorage.removeItem(t),this.handleCloseNote())}catch(e){}}else window.confirm("Delete this note (ID "+t+")?")&&(window.localStorage.removeItem(t),this.handleCloseNote())};highlightTextReader=()=>{if(void 0===this.highlighter.getHighlightsInSelection()[0])if("speechSynthesis"in window){let t=window.getSelection().toString();var e=new SpeechSynthesisUtterance;e.text=t,window.speechSynthesis.speak(e)}else alert("Sorry, your browser doesn't support text to speech!");else console.log("throw an error")}}var y=l((e=>({note:e.note.value})),(e=>({updated:t=>e(g(t)),clearNote:()=>e(p())})))(b);const S=n({reducer:{note:m}});function f(t){return e.createElement("div",null,e.createElement(a,{store:S},e.createElement(y,t)))}export{f as Highlighter};
